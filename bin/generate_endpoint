#!/usr/bin/env php
<?php
declare(strict_types=1);

use Firehed\API\Config;

$config = require 'load_config.php';

if ($argc < 2) {
    fwrite(STDERR, 'File name is required');
    exit(1);
}

$name = end($argv);
$namespace = $defaultUrl = explode('/', $name);
$className = array_pop($namespace);

$template = <<<'php'
<?php
declare(strict_types=1);

namespace %s%s;

use Firehed\API\Interfaces\AuthenticatedEndpointInterface;
use Firehed\API\Traits\Input;
use Firehed\API\Traits\Request;
use Firehed\Input\Containers\SafeInput;
use Firehed\InputObjects;
use Psr\Container\ContainerInterface;
use Psr\Http\Message\ResponseInterface;
use Throwable;

class %s implements AuthenticatedEndpointInterface
{
    // use Input\NoOptional;
    // use Input\NoRequired;
    // use Request\Get;

    /** @var ContainerInterface */
    private $auth;

    public function getUri(): string
    {
        return '/%s';
    }

    public function getRequiredInputs(): array
    {
        return [];
    }

    public function getOptionalInputs(): array
    {
        return [];
    }

    public function execute(SafeInput $input): ResponseInterface
    {
        // Implement this
    }

    public function setAuthentication(ContainerInterface $auth)
    {
        $this->auth = $auth;
    }

    public function handleException(Throwable $t): ResponseInterface
    {
        // Implememt this
    }
}
php;

$class = sprintf(
    $template,
    $config->get(Config::KEY_NAMESPACE),
    $namespace ? '\\' . implode('\\', array_map('ucfirst', $namespace)) : '',
    ucfirst($className),
    implode('/', $defaultUrl)
);

echo $class;
